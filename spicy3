Section = PlantDTKTab:AddSection("Position Plant")
-- Section gom m·∫•y control li√™n quan
-- kh·ªüi m·∫∑c ƒë·ªãnh n·∫øu ch∆∞a c√≥
config.AutoPlantSeedLoc      = config.AutoPlantSeedLoc      or false
config.RandomOthersSeed      = config.RandomOthersSeed      or false
config.SeedForLoc1           = config.SeedForLoc1           or {}
config.SeedForLoc2           = config.SeedForLoc2           or {}
config.SeedForLoc3           = config.SeedForLoc3           or {}
config.SeedForLoc4           = config.SeedForLoc4           or {}
config.ZoneSelector          = config.ZoneSelector          or { ["Zone 1 (right)"] = true, ["Zone 2 (left)"] = true }
-- === Khai b√°o chung ===
local ddLocation
local selectedLocation = "Location 1"
local locationList   = { "Location 1", "Location 2", "Location 3", "Location 4" }
local locationCFrames = {}
local selectedZones = {}
local seedOptions    = {
    "Nectarine","Hive Fruit","Sunflower","Purple Dahlia","Pink Lily","Carrot","Chocolate Carrot","Strawberry","Red Lollipop","Nightshade",
    "Blueberry","Orange Tulip","Tomato","Raspberry","Candy Sunflower","Rose","Foxglove","Lilac",
    "Glowshroom","Corn","Daffodil","Watermelon","Pumpkin","Apple","Bamboo",
    "Peach","Pineapple","Dragon Fruit","Cactus","Coconut","Mango","Grape",
    "Mushroom","Pepper","Cacao","Beanstalk","Easter Egg","Candy Blossom",
    "Durian","Cranberry","Eggplant","Lotus","Venus Flytrap","Rainbow Sack",
    "Papaya","Passionfruit","Banana","Cursed Fruit","Soul Fruit","Mint",
    "Moonflower","Starfruit","Moonglow","Moon Blossom","Blood Banana","Moon Melon"
}
local selectedSeedsByLocation = {
    ["Location 1"] = {},
    ["Location 2"] = {},
    ["Location 3"] = {},
    ["Location 4"] = {}
}

local DEFAULT_Y = 0.135527045

-- === 1) Toggle AutoPlantSeed (location) ===
local autoPlantSeedLoc = false
local randomOthersSeed = false
plantAt = function(pos, name)
    ReplicatedStore.GameEvents.Plant_RE:FireServer(pos, name)
    local cf = CFrame.new(pos)
    local gateway = Character.InputGateway or LocalPlayer.PlayerScripts.InputGateway
    for _, s in ipairs({true,false}) do
        gateway.Activation:FireServer(s, cf)
        task.wait(0.01)
    end
end
local sizeX, sizeY, sizeZ = 30.5, 0.001, 59
local function randomPoint(cf)
    local hx, hy, hz = sizeX/2, sizeY/2, sizeZ/2
    return (cf * CFrame.new(
        (math.random()*2-1)*hx,
        (math.random()*2-1)*hy,
        (math.random()*2-1)*hz
    )).Position
end


-- === AutoPlantSeedLoc Logic ===
plantseedB = PlantDTKTab:AddToggle("AutoPlantSeedLoc", {
    Title       = "Auto Planting",
    Description = "Planting by Location",
    Default     = config.AutoPlantSeedLoc,
    Callback    = function(state)
        config.AutoPlantSeedLoc = state; saveConfig()
        autoPlantSeedLoc = state
        print("[AutoPlantSeedLoc] Toggled:", state)

        if state then
            task.spawn(function()
                local hrp = Character:WaitForChild("HumanoidRootPart")
                local lastTp = 0
                local locNames = {"Location 1","Location 2","Location 3","Location 4"}

                -- L·∫•y farm v√† Can_Plant parts
                local farm = getMyFarm()
                local plantLocFolder = farm and farm.Important:FindFirstChild("Plant_Locations")
                if not plantLocFolder then
                    warn("[AutoPlantSeedLoc] Kh√¥ng t√¨m th·∫•y Plant_Locations!")
                    return
                end

                -- Gom c√°c Can_Plant v√†o m·∫£ng
                local rawParts = {}
                for _, cp in ipairs(plantLocFolder:GetChildren()) do
                    if cp:IsA("BasePart") and cp.Name == "Can_Plant" then
                        table.insert(rawParts, cp)
                    end
                end
                if #rawParts < 2 then
                    warn("[AutoPlantSeedLoc] Thi·∫øu √≠t nh·∫•t 2 Can_Plant ƒë·ªÉ x√°c ƒë·ªãnh Zone!")
                end

                -- ---- CH√àN LOGIC KI·ªÇM TRA ROTATION ----
                -- part ƒë·∫ßu ti√™n v√† th·ª© hai
                local part1, part2 = rawParts[1], rawParts[2]
                -- m·∫∑c ƒë·ªãnh zoneParts gi·ªØ ƒë√∫ng th·ª© t·ª± ban ƒë·∫ßu
                local zoneParts = { rawParts[1], rawParts[2] }
                if part1 and part2 then
                    -- l·∫•y rotation Euler c·ªßa t·ª´ng part
                    local r1 = part1.CFrame - part1.CFrame.Position
                    local r2 = part2.CFrame - part2.CFrame.Position
                    local angles1 = { r1:ToEulerAnglesXYZ() }
                    local angles2 = { r2:ToEulerAnglesXYZ() }
                    -- chuy·ªÉn rad ‚Üí deg v√† l√†m tr√≤n
                    for i=1,3 do
                        angles1[i] = math.deg(angles1[i]) % 360
                        angles1[i] = math.floor(angles1[i] + 0.5)
                        angles2[i] = math.deg(angles2[i]) % 360
                        angles2[i] = math.floor(angles2[i] + 0.5)
                    end
                    print(("[AutoPlantSeedLoc][Debug] Part1 Rot = (%d, %d, %d), Part2 Rot = (%d, %d, %d)")
                          :format(angles1[1],angles1[2],angles1[3], angles2[1],angles2[2],angles2[3]))
                    -- N·∫øu c·∫£ hai c√πng (180,0,180) ‚Üí part1 l√† Zone1
                    if angles1[1]==180 and angles1[2]==0 and angles1[3]==180
                    and angles2[1]==180 and angles2[2]==0 and angles2[3]==180 then
                        zoneParts = { rawParts[1], rawParts[2] }
                        print("[AutoPlantSeedLoc][Debug] C·∫£ 2 part ƒë·ªÅu (180,0,180), gi·ªØ nguy√™n zoneParts.")
                    -- N·∫øu c·∫£ hai c√πng (0,0,0) ‚Üí ho√°n ƒë·ªïi: part2 l√† Zone1, part1 l√† Zone2
                    elseif angles1[1]==0 and angles1[2]==0 and angles1[3]==0
                        and angles2[1]==0 and angles2[2]==0 and angles2[3]==0 then
                        zoneParts = { rawParts[2], rawParts[1] }
                        print("[AutoPlantSeedLoc][Debug] C·∫£ 2 part ƒë·ªÅu (0,0,0), swap zoneParts.")
                    else
                        print("[AutoPlantSeedLoc][Debug] Kh√¥ng th·ªèa ƒëi·ªÅu ki·ªán, gi·ªØ nguy√™n th·ª© t·ª± rawParts.")
                    end
                end

                -- X√¢y m·∫£ng zoneCenters d·ª±a tr√™n zoneParts ƒë√£ x√°c ƒë·ªãnh
                local zoneCenters = {}
                for idx, part in ipairs(zoneParts) do
                    zoneCenters[idx] = part.CFrame
                end

                -- V√≤ng l·∫∑p ch√≠nh
                while autoPlantSeedLoc do
                    print("[AutoPlantSeedLoc] randomOthersSeed =", randomOthersSeed)
                    for _, loc in ipairs(locNames) do
                        if not autoPlantSeedLoc then break end

                        local baseCF = locationCFrames[loc]
                        local seeds  = selectedSeedsByLocation[loc]
                        if not baseCF then
                            warn("[AutoPlantSeedLoc] Skipping", loc, "- no CFrame saved")
                        elseif not seeds or next(seeds)==nil then
                            warn("[AutoPlantSeedLoc] Skipping", loc, "- no seeds selected")
                        else
                            local dx = (math.random()*2-1)*3
                            local dz = (math.random()*2-1)*3
                            local plantPos = Vector3.new(
                                baseCF.Position.X + dx,
                                baseCF.Position.Y,
                                baseCF.Position.Z + dz
                            )

                            for seedName, on in pairs(seeds) do
                                if not autoPlantSeedLoc then break end
                                if on then
                                    local foundTool
                                    for _,container in ipairs({LocalPlayer.Backpack, Character}) do
                                        for _,tool in ipairs(container:GetChildren()) do
                                            if tool:IsA("Tool")
                                            and tool.Name:find(seedName.." Seed")
                                            and tool.Name:find("%[X%d+%]") then
                                                foundTool = tool; break
                                            end
                                        end
                                        if foundTool then break end
                                    end
                                    if not foundTool then
                                        warn("[AutoPlantSeedLoc] Tool not found:", seedName)
                                        continue
                                    end

                                    -- teleport v·ªÅ spawnPointPart n·∫øu c·∫ßn
                                    if spawnPointPart and tick()-lastTp >= 3 then
                                        hrp.CFrame = spawnPointPart.CFrame + Vector3.new(0,-2,0)
                                        task.wait(0.05)
                                        lastTp = tick()
                                    end
                                    while isTeleport do task.wait(0.02) end
                                    isTeleport = true

                                    Humanoid:EquipTool(foundTool)
                                    task.wait(0.1)
                                    print(("[AutoPlantSeedLoc] Equipped %s for %s"):format(seedName, loc))

                                    local success, err = pcall(function()
                                        plantAt(plantPos, seedName)
                                    end)
                                    isTeleport = false
                                    if success then
                                        print(("[AutoPlantSeedLoc] Planted %s at %s"):format(
                                            seedName, tostring(plantPos)
                                        ))
                                    else
                                        warn("[AutoPlantSeedLoc] Error planting:", err)
                                    end
                                    
                                    task.wait(0.1)
                                end
                            end
                        end
                    end

                    -- Ph·∫ßn randomOthersSeed (gi·ªØ nguy√™n)
                    if randomOthersSeed then
                        -- build filtered centers theo selectedZones
                        local centersFiltered = {}
                        for idx, cf in ipairs(zoneCenters) do
                            if selectedZones["Zone "..idx] then
                                table.insert(centersFiltered, cf)
                            end
                        end
                        if #centersFiltered == 0 then
                            warn("[AutoPlantSeedLoc] No zone selected, skipping RandomOthersSeed")
                        else
                            -- X√¢y blacklist t·ª´ seeds ƒë√£ ƒë∆∞·ª£c d√πng ·ªü 4 location
                            local used = {}
                            for _, loc in ipairs(locNames) do
                                for seedName, on in pairs(selectedSeedsByLocation[loc]) do
                                    if on then used[seedName] = true end
                                end
                            end

                            -- T·∫°o danh s√°ch seed *th·∫≠t* trong inventory (Backpack + Character)
                            local invSeeds = {}
                            for _, container in ipairs({LocalPlayer.Backpack, Character}) do
                                for _, tool in ipairs(container:GetChildren()) do
                                    if tool:IsA("Tool") then
                                        -- t√¨m seed: name ch·ª©a " Seed" v√† [Xn]
                                        local name = tool.Name
                                        local seedName = name:match("(.+) Seed")
                                        if seedName and name:find("%[X%d+%]") then
                                            -- n·∫øu ch∆∞a d√πng v√† ch∆∞a n·∫±m trong invSeeds th√¨ th√™m
                                            if not used[seedName] and not invSeeds[seedName] then
                                                invSeeds[seedName] = true
                                            end
                                        end
                                    end
                                end
                            end

                            -- Chuy·ªÉn invSeeds (map) th√†nh m·∫£ng
                            local avail = {}
                            for seedName,_ in pairs(invSeeds) do
                                table.insert(avail, seedName)
                            end

                            if #avail == 0 then
                                warn("[RandomOthersSeed] No available seeds in inventory to random plant")
                            else
                                -- Ch·ªçn v√† tr·ªìng 2 seed ng·∫´u nhi√™n t·ª´ avail
                                for i = 1, 2 do
                                    if #avail == 0 then break end
                                    local idx = math.random(#avail)
                                    local seedName = table.remove(avail, idx)

                                    -- random center
                                    local cfCenter = centersFiltered[math.random(#centersFiltered)]
                                    local plantPos = randomPoint(cfCenter)

                                    -- teleport n·∫øu c·∫ßn
                                    if spawnPointPart and tick() - lastTp >= 3 then
                                        hrp.CFrame = spawnPointPart.CFrame + Vector3.new(0, -2, 0)
                                        task.wait(0.05)
                                        lastTp = tick()
                                    end

                                    -- t√¨m tool seed trong inventory
                                    local toolFound
                                    for _,container in ipairs({LocalPlayer.Backpack, Character}) do
                                        for _, tool in ipairs(container:GetChildren()) do
                                            if tool:IsA("Tool")
                                            and tool.Name:find(seedName.." Seed")
                                            and tool.Name:find("%[X%d+%]") then
                                                toolFound = tool
                                                break
                                            end
                                        end
                                        if toolFound then break end
                                    end
                                    if not toolFound then
                                        warn("[RandomOthersSeed] Tool not found for", seedName)
                                        continue
                                    end

                                    -- Equip tool v√† plant
                                    Humanoid:EquipTool(toolFound)
                                    task.wait(0.1)
                                    pcall(function()
                                        plantAt(plantPos, seedName)
                                    end)
                                    print(("[RandomOthersSeed] Planted %s at %s"):format(seedName, tostring(plantPos)))
                                    task.wait(0.2)
                                end
                            end
                        end
                    end
                    task.wait(0.5)
                end
                print("[AutoPlantSeedLoc] Stopped")
            end)
        end
    end
})


plantseedA:OnChanged(function(state)
    if state then
        -- n·∫øu b·∫≠t B th√¨ t·∫Øt A
        plantseedB:SetValue(false)
    end
end)

plantseedB:OnChanged(function(state)
    if state then
        -- n·∫øu b·∫≠t B th√¨ t·∫Øt A
        plantseedA:SetValue(false)
    end
end)


-- === 2) Button ‚ÄúL∆∞u Location‚Äù ===
PlantDTKTab:AddButton({
    Title       = ("Save Location"):format(selectedLocation),
    Description = "Click to save Location",
    Callback    = function()
        if not ddLocation then return end

        local cf = hrp.CFrame
        local x, z = cf.X, cf.Z

        -- 1) L∆∞u CFrame v·ªõi Y c·ªë ƒë·ªãnh
        locationCFrames[selectedLocation] = CFrame.new(x, DEFAULT_Y, z)

        -- 2) ƒê·ªïi t√™n dropdown hi·ªÉn th·ªã, Y hi·ªÉn th·ªã = 0
        local shortName = string.format(
            "%s: %d, %d, %d",
            selectedLocation,
            x,
            0,
            z
        )
        for i, name in ipairs(locationList) do
            if name:find(selectedLocation) then
                locationList[i] = shortName
                break
            end
        end
        ddLocation:SetValues(locationList)
        ddLocation:SetValue(shortName)

        -- 3) Xo√° marker c≈© cho location n√†y n·∫øu c√≥
        local markerName = "Marker_" .. selectedLocation:gsub(" ", "")
        local old = workspace:FindFirstChild(markerName)
        if old then old:Destroy() end

        -- 4) T·∫°o marker 3D v·ªõi BillboardGui
        local part = Instance.new("Part")
        part.Name         = markerName
        part.Size         = Vector3.new(1,1,1)
        part.Transparency = 1
        part.Anchored     = true
        part.CanCollide   = false
        part.CFrame       = locationCFrames[selectedLocation]
        part.Parent       = workspace

        local bb = Instance.new("BillboardGui", part)
        bb.Name          = "LocationMarker"
        bb.Adornee       = part
        bb.AlwaysOnTop   = false
        bb.ExtentsOffset = Vector3.new(0,5,0)
        bb.Size          = UDim2.new(0,100,0,40)

        local lbl = Instance.new("TextLabel", bb)
        lbl.Size                   = UDim2.fromScale(1,1)
        lbl.BackgroundTransparency = 1
        lbl.Font                   = Enum.Font.SourceSansBold
        lbl.Text                   = selectedLocation
        lbl.TextColor3             = Color3.new(0.1, 0.8, 0.1)
        lbl.TextStrokeTransparency = 0.5
        lbl.TextScaled             = true
    end
})

-- === 3) Dropdown ch·ªçn Location hi·ªán t·∫°i ===
ddLocation = PlantDTKTab:AddDropdown("LocationSelector", {
    Title       = "Location to save",
    Description = "",
    Values      = locationList,
    Default     = selectedLocation,
    Callback    = function(val)
        selectedLocation = val:match("^Location %d") or val
    end
})

-- === 4‚Äì7) B·ªën Multi‚ÄëDropdown ‚ÄúSeed for Location X‚Äù ===
dropdownSeedForLoc1 = PlantDTKTab:AddDropdown("SeedForLoc1", {
    Title       = "Seeds for Location 1",
    Description = "",
    Values      = seedOptions,
    Multi       = true,
    Default     = config.SeedForLoc1,
    Callback    = function(sel)
        config.SeedForLoc1 = sel; saveConfig()
        selectedSeedsByLocation["Location 1"] = sel
    end
})
dropdownSeedForLoc1:SetValue(config.SeedForLoc1)

dropdownSeedForLoc2 = PlantDTKTab:AddDropdown("SeedForLoc2", {
    Title       = "Seeds for Location 2",
    Description = "",
    Values      = seedOptions,
    Multi       = true,
    Default     = config.SeedForLoc2,
    Callback    = function(sel)
        config.SeedForLoc2 = sel; saveConfig()
        selectedSeedsByLocation["Location 2"] = sel
    end
})
dropdownSeedForLoc2:SetValue(config.SeedForLoc2)

dropdownSeedForLoc3 = PlantDTKTab:AddDropdown("SeedForLoc3", {
    Title       = "Seeds for Location 3",
    Description = "",
    Values      = seedOptions,
    Multi       = true,
    Default     = config.SeedForLoc3,
    Callback    = function(sel)
        config.SeedForLoc3 = sel; saveConfig()
        selectedSeedsByLocation["Location 3"] = sel
    end
})
dropdownSeedForLoc3:SetValue(config.SeedForLoc3)

dropdownSeedForLoc4 = PlantDTKTab:AddDropdown("SeedForLoc4", {
    Title       = "Seeds for Location 4",
    Description = "",
    Values      = seedOptions,
    Multi       = true,
    Default     = config.SeedForLoc4,
    Callback    = function(sel)
        config.SeedForLoc4 = sel; saveConfig()
        selectedSeedsByLocation["Location 4"] = sel
    end
})
dropdownSeedForLoc4:SetValue(config.SeedForLoc4)

-- === 8) Toggle Random Others Seed ===

PlantDTKTab:AddToggle("RandomOthersSeed", {
    Title   = "Random Other Seeds",
    Description = "Random planting other Seeds",
    Default = config.RandomOthersSeed,
    Callback = function(state)
        config.RandomOthersSeed = state; saveConfig()
        randomOthersSeed = state
        print("", state)
    end
})

-- === 9) Multi Dropdown ch·ªçn Zone ===
zoneDropdown = PlantDTKTab:AddDropdown("ZoneSelector", {
    Title       = "Zone selector (for random)",
    Description = "",
    Values      = {"Zone 1 (right)", "Zone 2 (left)"},
    Multi       = true,
    Default     = config.ZoneSelector,
    Callback    = function(sel)
        config.ZoneSelector  = sel; saveConfig()
        selectedZones = sel
        print("", table.concat(sel, ", "))
    end
})
zoneDropdown:SetValue(config.ZoneSelector)



-- Th√™m section n·∫øu c·∫ßn


-- Gi·∫£ s·ª≠ b·∫°n ƒë√£ c√≥ bi·∫øn TeleportDTKTab tham chi·∫øu t·ªõi tab Teleport
-- v√† LocalPlayer, Character, HumanoidRootPart (hrp) ƒë√£ ƒë∆∞·ª£c kh·ªüi t·∫°o s·∫µn

TeleportDTKTab:AddButton({
    Title       = "Tp to Cosmetic Npc",
    Description = "",
    Callback    = function()
        -- L·∫•y HumanoidRootPart c·ªßa Chippy
        local chippyModel = workspace:FindFirstChild("NPCS")
                              and workspace.NPCS:FindFirstChild("CosmeticStand")
                              and workspace.NPCS.CosmeticStand:FindFirstChild("Chippy")
        if not chippyModel then
            warn("")
            return
        end

        local targetHRP = chippyModel:FindFirstChild("HumanoidRootPart")
        if not targetHRP then
            warn("")
            return
        end

        -- T·ªça ƒë·ªô nh√¢n v·∫≠t
        local playerChar = LocalPlayer.Character
        if not playerChar then
            warn("")
            return
        end

        local hrp = playerChar:FindFirstChild("HumanoidRootPart")
        if not hrp then
            warn("")
            return
        end

        -- T√≠nh CFrame ƒë√≠ch: 5 studs tr∆∞·ªõc m·∫∑t Chippy
        -- Chippy h∆∞·ªõng theo targetHRP.CFrame.LookVector
        local lookVec = targetHRP.CFrame.LookVector
        local destinationCF = CFrame.new(
            targetHRP.Position - lookVec * -5,   -- l√πi 5 studs theo LookVector
            targetHRP.Position                  -- nh√¨n v·ªÅ h∆∞·ªõng Chippy
        )
        -- Gi·ªØ c√πng orientation v·ªõi camera ho·∫∑c xoay th·∫≥ng v·ªÅ NPC
        -- n·∫øu ch·ªâ c·∫ßn ƒë·∫∑t v·ªã tr√≠: 
        -- local destinationCF = targetHRP.CFrame * CFrame.new(0, 0, -5)

        -- Teleport nh√¢n v·∫≠t
        hrp.CFrame = destinationCF

    end
})

TeleportDTKTab:AddButton({
    Title = "Tp to Honey Queen",
    Callback = function()
        -- L·∫•y folder th·ª© 5 trong HoneyEvent
        local honeyEventFolder = workspace:WaitForChild("Interaction")
                                      :WaitForChild("UpdateItems")
                                      :WaitForChild("HoneyEvent")
        local fifthChild = honeyEventFolder:GetChildren()[5]
        if not fifthChild then
            warn("")
            return
        end

        -- L·∫•y Part con c√≥ t√™n "26"
        local targetFolder = fifthChild:FindFirstChild("26")
        if not targetFolder then
            warn("")
            return
        end

        local target = targetFolder:FindFirstChild("Part")
        if target and target:IsA("BasePart") then
            -- D·ªãch cao l√™n 1 stud so v·ªõi v·ªã tr√≠ Part
            local newCFrame = CFrame.new(target.Position + Vector3.new(0, 3, 0))
            -- Teleport ng∆∞·ªùi ch∆°i
            local hrp = Character:WaitForChild("HumanoidRootPart")
            hrp.CFrame = newCFrame
        else
            warn("")
        end
    end
})





Section = TeleportDTKTab:AddSection("Players Teleport")
-- === 0) Kh·ªüi t·∫°o config ƒë·ªÉ l∆∞u Selection ===
config.TeleportPlayer = config.TeleportPlayer or nil

-- === 1) Bi·∫øn chung ===
  -- gi·∫£ s·ª≠ b·∫°n c√≥ tab n√†y
local teleDropdown   = nil
local playerNames    = {}   -- m·∫£ng t√™n model
local selectedTarget = config.TeleportPlayer

-- H√†m l·∫•y t·∫•t c·∫£ model player trong workspace
local function rebuildPlayerList()
    playerNames = {}
    for _, inst in ipairs(workspace:GetChildren()) do
        -- L·ªçc ra Model c√≥ Humanoid v√† c√≥ con HumanoidRootPart
        if inst:IsA("Model") and inst:FindFirstChild("Humanoid") 
        and inst:FindFirstChild("HumanoidRootPart") then
            table.insert(playerNames, inst.Name)
        end
    end
    table.sort(playerNames)      -- optional: s·∫Øp x·∫øp theo ch·ªØ
end

-- === 2) T·∫°o UI ===
-- A) n√∫t Refresh
TeleportDTKTab:AddButton({
    Title       = "Refresh Player List",
    Description = "",
    Callback    = function()
        rebuildPlayerList()
        if teleDropdown then
            teleDropdown:SetValues(playerNames)
            -- n·∫øu config.TP ƒë√£ c√≥ nh∆∞ng kh√¥ng c√≤n trong list th√¨ clear
            if not table.find(playerNames, selectedTarget) then
                selectedTarget = nil
                config.TeleportPlayer = nil; saveConfig()
            end
            teleDropdown:SetValue(selectedTarget or playerNames[1])
        end
    end
})

-- B) Dropdown Teleport
teleDropdown = TeleportDTKTab:AddDropdown("TeleportPlayer", {
    Title       = "Choose a Player to TP",
    Description = "",
    Values      = playerNames,
    Default     = selectedTarget,
    Callback    = function(val)
        selectedTarget = val
        config.TeleportPlayer = val; saveConfig()
    end
})

-- C) Button Th·ª±c thi Teleport
TeleportDTKTab:AddButton({
    Title       = "Teleport Now",
    Description = "",
    Callback    = function()
        if not selectedTarget then
            warn("")
            return
        end
        local targetModel = workspace:FindFirstChild(selectedTarget)
        if targetModel 
        and targetModel:FindFirstChild("HumanoidRootPart") then
            local hrp = Character:FindFirstChild("HumanoidRootPart") 
                        or Character.PrimaryPart
            if hrp then
                hrp.CFrame = targetModel.HumanoidRootPart.CFrame
                print((""):format(selectedTarget))
            else
                warn("")
            end
        else
            warn((""):format(selectedTarget))
        end
    end
})


-- === 3) Kh·ªüi ch·∫°y l·∫ßn ƒë·∫ßu ===
rebuildPlayerList()
teleDropdown:SetValues(playerNames)
-- n·∫øu config c√≥ value v√† t·ªìn t·∫°i th√¨ set, ng∆∞·ª£c l·∫°i m·∫∑c ƒë·ªãnh ch·ªçn first
if table.find(playerNames, selectedTarget) then
    teleDropdown:SetValue(selectedTarget)
else
    selectedTarget = playerNames[1]
    teleDropdown:SetValue(selectedTarget)
    config.TeleportPlayer = selectedTarget; saveConfig()
end




Section = FavoriteDTKTab:AddSection("Favorite Fruits")
-- ======= Auto Favorite Fruits =======
-- 0) Config m·∫∑c ƒë·ªãnh
config.AutoFavFruit          = config.AutoFavFruit          or false
config.FavFruitSelection     = config.FavFruitSelection     or { All = true }
config.FavMutSelection       = config.FavMutSelection       or {}
config.FavWeightThreshold    = config.FavWeightThreshold    or 5   -- ƒë∆∞a threshold v√†o config lu√¥n

-- Kh·ªüi t·∫°o bi·∫øn runtime t·ª´ config
local weightThresholdF = config.FavWeightThreshold

-- 1) Multi-Dropdown: Ch·ªçn lo·∫°i tr√°i
local fruitOptions = {
    "All","Nectarine","Hive Fruit","Sunflower","Purple Dahlia","Pink Lily","Carrot","Chocolate Carrot","Strawberry","Red Lollipop","Nightshade",
    "Blueberry","Orange Tulip","Tomato","Raspberry","Candy Sunflower","Rose","Foxglove","Lilac",
    "Glowshroom","Corn","Daffodil","Watermelon","Pumpkin","Apple","Bamboo",
    "Peach","Pineapple","Dragon Fruit","Cactus","Coconut","Mango","Grape",
    "Mushroom","Pepper","Cacao","Beanstalk","Easter Egg","Candy Blossom",
    "Durian","Cranberry","Eggplant","Lotus","Venus Flytrap","Rainbow Sack",
    "Papaya","Passionfruit","Banana","Cursed Fruit","Soul Fruit","Mint",
    "Moonflower","Starfruit","Moonglow","Moon Blossom","Blood Banana","Moon Melon"
}
local mutationOptions = {
    "Pollinated", "Choc", "Celestial","Shocked","Rainbow","Gold","Plasma","Voidtouched","HoneyGlazed","Frozen","Bloodlit","Wet",
    "Zombified","Chilled","Disco"
}

-- 2) Toggle: Auto-favorite
-- 2) Toggle: Auto-favorite
FavoriteDTKTab:AddToggle("AutoFavFruit", {
    Title   = "Auto favorite fruit",
    Default = config.AutoFavFruit,
    Callback = function(state)
        config.AutoFavFruit = state
        saveConfig()
        autoFavFruit = state

        if state then
            -- 1) Kh·ªüi t·∫°o set nh·ªØng tool ƒë√£ favorite s·∫µn (c·∫£ l·∫ßn tr∆∞·ªõc), d√πng object tool l√†m key
            local alreadyFavored = {}
            for _, tool in ipairs(LocalPlayer.Backpack:GetChildren()) do
                if tool:IsA("Tool") and tool:GetAttribute("Favorite") then
                    alreadyFavored[tool] = true
                end
            end

            task.spawn(function()
                local plr = Players.LocalPlayer
                local favRemote = ReplicatedStorage
                    :WaitForChild("GameEvents")
                    :WaitForChild("Favorite_Item")

                while autoFavFruit do
                    for _, tool in ipairs(plr.Backpack:GetChildren()) do
                        if not tool:IsA("Tool") then
                            continue
                        end

                        -- N·∫øu ƒë√£ favorite tool n√†y r·ªìi (theo object, kh√¥ng ph·∫£i theo name), b·ªè qua
                        if alreadyFavored[tool] then
                            continue
                        end

                        local name = tool.Name

                        -- l·ªçc ‚Äúkg‚Äù
                        if not name:lower():find("kg") then
                            continue
                        end

                        -- l·ªçc lo·∫°i tr√°i
                        local okType = config.FavFruitSelection.All
                        if not okType then
                            okType = false
                            for ft, on in pairs(config.FavFruitSelection) do
                                if on and ft ~= "All" and name:find(ft) then
                                    okType = true
                                    break
                                end
                            end
                        end
                        if not okType then
                            continue
                        end

                        -- l·ªçc mutation
                        local okMut = true
                        local anyMutSelected = false
                        for mut, on in pairs(config.FavMutSelection) do
                            if mut ~= "All" and on then
                                anyMutSelected = true
                                if name:find(mut) then
                                    okMut = true
                                    break
                                else
                                    okMut = false
                                end
                            end
                        end
                        -- N·∫øu c√≥ ch·ªçn mutation m√† kh√¥ng tool n√†o kh·ªõp ‚Üí continue
                        if anyMutSelected and not okMut then
                            continue
                        end

                        -- l·ªçc weight
                        local wtStr = name:match("([%d%.]+)kg")
                        local wnum  = wtStr and tonumber(wtStr) or 0
                        if wnum <= config.FavWeightThreshold then
                            continue
                        end

                        -- call remote favorite (d√πng lu√¥n tool ch·ª© kh√¥ng ph·∫£i t√™n)
                        pcall(function()
                            favRemote:FireServer(tool)
                        end)

                        -- ƒë√°nh d·∫•u ƒë√£ favorite tool n√†y
                        alreadyFavored[tool] = true

                        task.wait(0.02)
                    end
                    task.wait(0.02)
                end
            end)
        end
    end
})



-- 3) Multi-Dropdown Fruits Filter
ddFruit = FavoriteDTKTab:AddDropdown("FavFruitFilter", {
    Title       = "Fruits Filter",
    Description = "Fruits for favorite",
    Values      = fruitOptions,
    Multi       = true,
    Default     = config.FavFruitSelection,
    Callback    = function(sel)
        config.FavFruitSelection = sel
        saveConfig()
    end
})
ddFruit:SetValue(config.FavFruitSelection)

-- 4) Multi-Dropdown Mutation Filter
ddMut = FavoriteDTKTab:AddDropdown("FavMutFilter", {
    Title       = "Mutation Filter",
    Description = "Mutation for favorite",
    Values      = mutationOptions,
    Multi       = true,
    Default     = config.FavMutSelection,
    Callback    = function(sel)
        config.FavMutSelection = sel
        saveConfig()
    end
})
ddMut:SetValue(config.FavMutSelection)

-- 5) Input: weight threshold
weightfilterfav = FavoriteDTKTab:AddInput("WeightThreshold", {
    Title       = "WeightThreshold",
    Description = "Favorite fruits ‚â• x",
    Placeholder = "",
    Default     = tostring(config.FavWeightThreshold),
    Numeric     = true,
    Callback    = function(v)
        local num = tonumber(v)
        if num then
            weightThresholdF = num
            config.FavWeightThreshold = num
            saveConfig()
        else
            warn("!")
        end
    end
})
weightfilterfav:SetValue(config.FavWeightThreshold)

FavoriteDTKTab:AddButton({
    Title       = "Unfavorite All Fruits",
    Description = "",
    Callback    = function()
        local plr = Players.LocalPlayer
        local favRemote = ReplicatedStorage
            :WaitForChild("GameEvents")
            :WaitForChild("Favorite_Item")

        -- Duy·ªát Backpack
        for _, tool in ipairs(plr.Backpack:GetChildren()) do
            if tool:IsA("Tool") and tool:GetAttribute("Favorite") then
                -- G·ªçi Remote ƒë·ªÉ unfavorite
                pcall(function()
                    favRemote:FireServer(tool)
                end)
                task.wait(0.05)
            end
        end

        -- Duy·ªát Character (tr∆∞·ªùng h·ª£p ƒëang c·∫ßm tool)
        for _, tool in ipairs(plr.Character:GetChildren()) do
            if tool:IsA("Tool") and tool:GetAttribute("Favorite") then
                pcall(function()
                    favRemote:FireServer(tool)
                end)
                task.wait(0.05)
            end
        end

    end
})




local startTime = tick()
local uptimeParagraph = ServerDTKTab:AddParagraph({
    Title   = "Server Timing",
    Content = ("Hour: %02d, Minute: %02d, Second: %02d")
              :format(0, 0, 0)
})

-- Spawn m·ªôt lu·ªìng ƒë·ªÉ update m·ªói gi√¢y
task.spawn(function()
    while true do
        local elapsed = math.floor(tick() - startTime)
        local hrs  = math.floor(elapsed / 3600)
        local mins = math.floor((elapsed % 3600) / 60)
        local secs = elapsed % 60
        local newText = ("Hour: %02d, Minute: %02d, Second: %02d")
                        :format(hrs, mins, secs)

        -- Qu√©t v√† set l·∫°i text cho label ch·ª©a uptime
        for _, desc in ipairs(uptimeParagraph.Frame:GetDescendants()) do
            if desc:IsA("TextLabel") and desc.Text:match("Hour:") then
                desc.Text = newText
            end
        end

        task.wait(1)
    end
end)

-- 2) H√†m format & c·∫≠p nh·∫≠t l·∫°i
local function updateUptime()
    local elapsed = math.floor(tick() - startTime)
    local hrs  = math.floor(elapsed / 3600)
    local mins = math.floor((elapsed % 3600) / 60)
    local secs = elapsed % 60

    local newText = ("Hour: %02d, Minute: %02d, Second: %02d")
                    :format(hrs, mins, secs)

    -- T√πy API c·ªßa lib UI, d√πng method ph√π h·ª£p:
    if uptimeParagraph.SetContent then
        uptimeParagraph:SetContent(newText)
    elseif uptimeParagraph.SetValue then
        uptimeParagraph:SetValue(newText)
    else
        -- N·∫øu control l∆∞u text ·ªü .Content
        uptimeParagraph.Content = newText
    end
end

-- 3) V√≤ng loop c·∫≠p nh·∫≠t m·ªói 1s
spawn(function()
    while true do
        updateUptime()
        task.wait(1)
    end
end)
-- 1) T·∫°o Paragraph hi·ªÉn th·ªã th·ªùi gian kh·ªüi ƒë·ªông
-- Gi·∫£ s·ª≠ b·∫°n ƒë√£ g·ªçi




-- Gi·∫£ s·ª≠ b·∫°n ƒë√£ c√≥ bi·∫øn ServerDTKTab (v√≠ d·ª• do Fluent UI t·∫°o)
-- local ServerDTKTab = Window:MakeTab("Server", ...)
local jobIdInput
ServerDTKTab:AddInput("JobIdInput", {
    Title       = "Join JobId",
    Placeholder = "",
    Default     = "",
    Numeric     = false, -- JobId c√≥ ch·ªØ n√™n false
    Finished    = false, -- kh√¥ng g·ªçi callback onEnter, ta d√πng n√∫t b·∫•m
    Callback    = function(txt)
        jobIdInput = txt
        -- B·∫°n c√≥ th·ªÉ in debug:
        print("", jobIdInput)
    end
})
-- 3) Th√™m Button ‚ÄúJoin ID‚Äù
ServerDTKTab:AddButton({
    Title       = "Join ID",
    Description = "",
    Callback    = function()
        -- L·∫•y gi√° tr·ªã t·ª´ jobIdInput
        local jobId = jobIdInput or ""
        jobId = jobId:match("%S+") or "" -- trim
        if jobId == "" then
            warn("[JoinJob] !")
            return
        end

        -- L·∫•y PlaceId hi·ªán t·∫°i
        local placeId = game.PlaceId

        -- Th·ª±c hi·ªán teleport
        print((""):format(placeId, jobId))
        pcall(function()
            TeleportService:TeleportToPlaceInstance(placeId, jobId, LocalPlayer)
        end)
    end
})
-- T·∫°o n√∫t
ServerDTKTab:AddButton({
    Title       = "Copy Job ID",
    Description = "",
    Callback    = function()
        -- L·∫•y Job ID
        local jobId = game.JobId or ""
        if jobId == "" then
            warn("[CopyJobId]  JobId!")
            return
        end

        -- ƒê∆∞a v√†o clipboard (ch·ªâ ho·∫°t ƒë·ªông tr√™n studio ho·∫∑c m√¥i tr∆∞·ªùng h·ªó tr·ª£ setclipboard)
        pcall(function()
            setclipboard(jobId)
        end)

        -- Th√¥ng b√°o cho user
        print("", jobId)
    end
})







Section = RemoveDTKTab:AddSection("Destroy Plants")

-- ========== Ph·∫ßn ƒë·∫ßu: Khai b√°o helper & config ==========

local Players           = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalPlayer       = Players.LocalPlayer

-- Module t√≠nh value/mutation (gi·∫£ s·ª≠ ƒë√£ require ·ªü ƒë·∫ßu file)
local ItemModule       = require(ReplicatedStorage:WaitForChild("Item_Module"))
local MutationHandler  = require(ReplicatedStorage.Modules:WaitForChild("MutationHandler"))

-- Remote event ƒë·ªÉ ph√° c√¢y
local RemoveItemEvent = ReplicatedStorage
    :WaitForChild("GameEvents")
    :WaitForChild("Remove_Item")

-- Config m·∫∑c ƒë·ªãnh
config.AutoRemoveTrees       = config.AutoRemoveTrees       or false
config.ZoneRemoveFilter      = config.ZoneRemoveFilter      or { ["Zone 1 (right)"]=true, ["Zone 2 (left)"]=true }
config.PlantRemoveFilter     = config.PlantRemoveFilter     or { ["All"]=true }      -- n·∫øu ƒë·ªÉ {} t·ª©c m·∫∑c ƒë·ªãnh KH√îNG ch·ªçn c√¢y n√†o
config.WeightRemoveFilter    = config.WeightRemoveFilter    or "20"
config.ValueRemoveFilter     = config.ValueRemoveFilter     or "10000000"
config.MutationRemoveFilter  = config.MutationRemoveFilter  or {}

-- State
local autoRemove        = false
local selectedZones     = {}   -- map["Zone 1"]=true/false,...
local selectedPlants    = {}   -- map["Carrot"]=true/false,..
local weightThreshold   = tonumber(config.WeightRemoveFilter) or 0
local valueThreshold    = tonumber(config.ValueRemoveFilter)  or 0
local blockedMutions    = {}   -- map mutation‚Üítrue


-- Kh·ªüi selectedZones t·ª´ config
for zone, on in pairs(config.ZoneRemoveFilter) do
    if on then selectedZones[zone] = true end
end


-- ========== Helper functions ==========

-- L·∫•y farm c·ªßa ng∆∞·ªùi ch∆°i
local function getMyFarm()
    for _, f in ipairs(workspace:WaitForChild("Farm"):GetChildren()) do
        local imp = f:FindFirstChild("Important")
        local data = imp and imp:FindFirstChild("Data")
        if data and data:FindFirstChild("Owner") and data.Owner.Value == LocalPlayer.Name then
            return f
        end
    end
    return nil
end

-- T√≠nh t·ªïng value c·ªßa c√¢y
local function calcPlantValue(plantModel)
    local sum = 0
    local fruits = plantModel:FindFirstChild("Fruits")
    if fruits then
        for _, fruit in ipairs(fruits:GetChildren()) do
            if fruit:IsA("Model") then
                local name   = (fruit:FindFirstChild("Item_String") and fruit.Item_String.Value) or fruit.Name
                local varObj = fruit:FindFirstChild("Variant")
                local wObj   = fruit:FindFirstChild("Weight")
                if varObj and wObj then
                    local data = ItemModule.Return_Data(name)
                    if data and #data >= 3 then
                        local tier = data[2]
                        local base = data[3]
                        local vm   = ItemModule.Return_Multiplier(varObj.Value) or 1
                        local mm   = MutationHandler:CalcValueMulti(fruit)
                        local r    = math.clamp(wObj.Value / tier, 0.95, 1e8)
                        sum += math.round(base * vm * mm * (r*r))
                    end
                end
            end
        end
    end
    return sum
end

-- X√°c ƒë·ªãnh zone 1 / zone 2 d·ª±a tr√™n rotation c·ªßa hai part "Can_Plant"
local zoneParts = {}
do
    local farm = getMyFarm()
    if farm then
        local locs = farm.Important:WaitForChild("Plant_Locations")
        local raw  = {}
        for _, p in ipairs(locs:GetChildren()) do
            if p:IsA("BasePart") and p.Name == "Can_Plant" then
                table.insert(raw, p)
            end
        end
        zoneParts = raw
        if #raw >= 2 then
            local function deg(c)
                local x,y,z = (c - c.Position):ToEulerAnglesXYZ()
                return math.floor(math.deg(x)+0.5)%360,
                       math.floor(math.deg(y)+0.5)%360,
                       math.floor(math.deg(z)+0.5)%360
            end
            local r1x,r1y,r1z = deg(raw[1].CFrame)
            local r2x,r2y,r2z = deg(raw[2].CFrame)
            if r1x==180 and r1y==0 and r1z==180 and r2x==180 and r2y==0 and r2z==180 then
                zoneParts = { raw[1], raw[2] }
            elseif r1x==0 and r1y==0 and r1z==0 and r2x==0 and r2y==0 and r2z==0 then
                zoneParts = { raw[2], raw[1] }
            end
        end
    end
end

-- Ki·ªÉm tra m·ªôt c√¢y c√≥ n·∫±m trong zone ƒë√£ ch·ªçn hay kh√¥ng
-- Ki·ªÉm tra m·ªôt c√¢y c√≥ n·∫±m trong zone ƒë√£ ch·ªçn (theo b√°n k√≠nh) hay kh√¥ng
local function inZone(mdl)
    if #zoneParts < 2 then
        return true
    end

    -- L·∫•y v·ªã tr√≠ trung t√¢m model (PrimaryPart ho·∫∑c Base)
    local root = mdl.PrimaryPart or mdl:FindFirstChild("Base")
    if not root then
        return true
    end
    local px, pz = root.Position.X, root.Position.Z

    -- Gi·ªõi h·∫°n b√°n k√≠nh (radius) cho zone
    local R = 35  -- b·∫°n c√≥ th·ªÉ tƒÉng/gi·∫£m tu·ª≥ √Ω

    for idx, part in ipairs(zoneParts) do
        if selectedZones["Zone "..idx] then
            local cx, cz = part.Position.X, part.Position.Z
            local dx, dz = px - cx, pz - cz
            if (dx*dx + dz*dz) <= (R*R) then
                return true
            end
        end
    end

    return false
end



-- ========== Ph·∫ßn UI ==========

-- 1) Toggle
RemoveDTKTab:AddToggle("AutoRemoveTrees", {
    Title   = "Destroy Plants",
    Default = config.AutoRemoveTrees,
    Callback = function(state)
        config.AutoRemoveTrees = state; saveConfig()
        autoRemove = state

        if autoRemove then
            -- Thread ch√≠nh
            task.spawn(function()
                while autoRemove do
                    -- M·ªói gi√¢y: equip l·∫°i shovel n·∫øu c√≤n c√¢y h·ª£p l·ªá ƒë·ªÉ ph√°
                    local farm = getMyFarm()
                    local phys = farm and farm.Important:FindFirstChild("Plants_Physical")
                    local needShovel = false
                    if phys then
                        for _, mdl in ipairs(phys:GetChildren()) do
                            if selectedPlants[mdl.Name]
                            and inZone(mdl)
                            and (mdl:FindFirstChild("Weight",true) or {Value=0}).Value < weightThreshold
                            and calcPlantValue(mdl) < valueThreshold then
                                needShovel = true
                                break
                            end
                        end
                    end
                    if needShovel then
                        local shovel = LocalPlayer.Backpack:FindFirstChild("Shovel [Destroy Plants]")
                        if shovel then
                            local cur = Humanoid:FindFirstChildOfClass("Tool")
                            if not cur or cur.Name ~= shovel.Name then
                                Humanoid:EquipTool(shovel)
                            end
                        end
                    end

                    -- Ti·∫øn h√†nh qu√©t & destroy
                    if phys then
                        for _, mdl in ipairs(phys:GetChildren()) do
                            if not autoRemove then break end
                            if not selectedPlants[mdl.Name] then continue end
                            if not inZone(mdl) then continue end

                            local w = mdl:FindFirstChild("Weight",true)
                            if w and w.Value >= weightThreshold then continue end

                            local val = calcPlantValue(mdl)
                            if val >= valueThreshold then continue end

                            local skip = false
                            local fruits = mdl:FindFirstChild("Fruits")
                            if fruits then
                                for _, f in ipairs(fruits:GetChildren()) do
                                    if skip then break end
                                    for mut in pairs(blockedMutions) do
                                        if f:GetAttribute(mut) then skip = true; break end
                                    end
                                end
                            else
                                for mut in pairs(blockedMutions) do
                                    if mdl:GetAttribute(mut) then skip = true; break end
                                end
                            end
                            if skip then continue end

                            for _, part in ipairs(mdl:GetChildren()) do
                                if not autoRemove then break end
                                if part:IsA("BasePart") then
                                    RemoveItemEvent:FireServer(part)
                                    task.wait(0.01)
                                end
                            end
                        end
                    end

                    task.wait(1)
                end
            end)
        end
    end
})

-- 2) Zone selector
local zoneDropdown = RemoveDTKTab:AddDropdown("ZoneRemoveFilter", {
    Title       = "Zone Filter",
    Description = "Select zone to remove",
    Values      = { "Zone 1 (right)", "Zone 2 (left)" },
    Multi       = true,
    Default     = config.ZoneRemoveFilter,
    Callback    = function(sel)
        config.ZoneRemoveFilter = sel; saveConfig()
        selectedZones = {}
        for k,v in pairs(sel) do
            if v then selectedZones[k] = true end
        end
    end
})
zoneDropdown:SetValue(config.ZoneRemoveFilter)

-- 3) Plants to destroy (c√≥ ‚ÄúAll‚Äù)
local function getUniquePlantNames()
    local out = { "All" }
    local farm = getMyFarm()
    if not farm then return out end
    local phys = farm.Important:FindFirstChild("Plants_Physical")
    if not phys then return out end
    local seen = {}
    for _, mdl in ipairs(phys:GetChildren()) do
        if mdl:IsA("Model") and not seen[mdl.Name] then
            seen[mdl.Name] = true
            table.insert(out, mdl.Name)
        end
    end
    return out
end

plantDropdown = RemoveDTKTab:AddDropdown("PlantRemoveFilter", {
    Title       = "Plants to destroy",
    Description = "Plants in your garden",
    Values      = getUniquePlantNames(),
    Multi       = true,
    Default     = config.PlantRemoveFilter,
    Callback    = function(sel)
        config.PlantRemoveFilter = sel; saveConfig()
        selectedPlants = {}

        if sel["All"] then
            for _, name in ipairs(getUniquePlantNames()) do
                if name ~= "All" then
                    selectedPlants[name] = true
                end
            end
        else
            for name,on in pairs(sel) do
                if on and name ~= "All" then
                    selectedPlants[name] = true
                end
            end
        end
    end
})
plantDropdown:SetValue(config.PlantRemoveFilter)

-- 4) Refresh plant list
RemoveDTKTab:AddButton({
    Title    = "üîÑ Refresh Plant list",
    Callback = function()
        local opts = getUniquePlantNames()
        plantDropdown:SetValues(opts)
        config.PlantRemoveFilter = {}; saveConfig()
        plantDropdown:SetValue({})
        selectedPlants = {}
    end
})

-- 5) Weight filter
weightInput = RemoveDTKTab:AddInput("WeightRemoveFilter", {
    Title       = "Weight Filter (kg)",
    Description = "Ignore fruits ‚â• x kg",
    Placeholder = "",
    Default     = config.WeightRemoveFilter,
    Numeric     = true,
    Callback    = function(v)
        local n = tonumber(v)
        if n then
            weightThreshold = n
            config.WeightRemoveFilter = v; saveConfig()
        end
    end
})
weightInput:SetValue(config.WeightRemoveFilter)

-- 6) Value filter
valueInput = RemoveDTKTab:AddInput("ValueRemoveFilter", {
    Title       = "Value Filter ($)",
    Description = "Ignore fruits ‚â• x $",
    Placeholder = "",
    Default     = config.ValueRemoveFilter,
    Numeric     = true,
    Callback    = function(v)
        local n = tonumber(v)
        if n then
            valueThreshold = n
            config.ValueRemoveFilter = v; saveConfig()
        end
    end
})
valueInput:SetValue(config.ValueRemoveFilter)

-- 7) Mutation filter
ddMutRm = RemoveDTKTab:AddDropdown("MutationRemoveFilter", {
    Title       = "Mutation Filter",
    Description = "Ignore mutations",
    Values      = allMutions,
    Multi       = true,
    Default     = config.MutationRemoveFilter,
    Callback    = function(sel)
        config.MutationRemoveFilter = sel; saveConfig()
        blockedMutions = {}
        for mut,on in pairs(sel) do
            if on then blockedMutions[mut] = true end
        end
    end
})
ddMutRm:SetValue(config.MutationRemoveFilter)





Section = RemoveDTKTab:AddSection("Sell Pet Inventory")
-- Remote Sell Pet
local SellPetRemote = ReplicatedStorage
    :WaitForChild("GameEvents")
    :WaitForChild("SellPet_RE")

-- ======== 0) Config m·∫∑c ƒë·ªãnh ========
config.AutoSellPets      = config.AutoSellPets      or false
config.PetsToSell        = config.PetsToSell        or { ["All (except favorite)"] = true }

-- ======== 1) H√†m helper: L·∫•y t·∫•t c·∫£ tools ch·ª©a "Age" ========
local function getAllAgeTools()
    local out = {}
    for _, container in ipairs({LocalPlayer.Backpack, Character}) do
        if container then
            for _, tool in ipairs(container:GetChildren()) do
                if tool:IsA("Tool") and tool.Name:find("Age") then
                    table.insert(out, tool)
                end
            end
        end
    end
    return out
end

-- ======== 2) Helper: Build danh s√°ch dropdown ========
local function buildPetList()
    local list = {"All (except favorite)"}
    for _, tool in ipairs(getAllAgeTools()) do
        table.insert(list, tool.Name)
    end
    return list
end

-- ======== 3) Toggle Auto Sell Pets ========
local autoSellPets = config.AutoSellPets
RemoveDTKTab:AddToggle("AutoSellPets", {
    Title   = "Auto Sell Pets",
    Default = autoSellPets,
    Callback = function(state)
        config.AutoSellPets = state
        saveConfig()
        autoSellPets = state

        if state then
            task.spawn(function()
                while autoSellPets do
                    -- 1) X√¢y danh s√°ch tool ch∆∞a favorite
                    local allTools = getAllAgeTools()
                    local toSell = {}

                    if config.PetsToSell["All (except favorite)"] then
                        -- Ch·ªçn all tool ch∆∞a favorite
                        for _, tool in ipairs(allTools) do
                            if not tool:GetAttribute("Favorite") then
                                table.insert(toSell, tool)
                            end
                        end
                    else
                        -- Ch·ªçn tool theo config.PetsToSell map[toolName] = true
                        for _, tool in ipairs(allTools) do
                            if not tool:GetAttribute("Favorite")
                            and config.PetsToSell[tool.Name] then
                                table.insert(toSell, tool)
                            end
                        end
                    end

                    -- 2) L·∫ßn l∆∞·ª£t equip + FireServer
                    for _, tool in ipairs(toSell) do
                        while isTeleport do task.wait(0.02) end
                        isTeleport = true
                        if not autoSellPets then break end
                        -- equip
                        pcall(function()
                            Humanoid:EquipTool(tool)
                        end)
                        task.wait(0.05)
                        -- g·ªçi remote v·ªõi tool ƒëang c·∫ßm
                        pcall(function()
                            SellPetRemote:FireServer(tool)
                        end)
                        task.wait(0.1)
                        isTeleport = false
                    end

                    task.wait(0.5)
                end
            end)
        end
    end
})

-- ======== 4) Dropdown ch·ªçn pets to sell ========
local petList = buildPetList()
ddPets = RemoveDTKTab:AddDropdown("PetsToSell", {
    Title       = "Pets to Sell",
    Description = "Except favorite Pets",
    Values      = petList,
    Multi       = true,
    Default     = config.PetsToSell,
    Callback    = function(selection)
        config.PetsToSell = selection
        saveConfig()
    end
})
ddPets:SetValue(config.PetsToSell)

-- ======== 5) Button Refresh danh s√°ch pets ========
RemoveDTKTab:AddButton({
    Title       = "üîÑ Refresh Pets List",
    Description = "",
    Callback    = function()
        local newList = buildPetList()
        ddPets:SetValues(newList)
        ddPets:SetValue(config.PetsToSell)

    end
})





Section = FavoriteDTKTab:AddSection("Favorite Pets")
-- 0) Config & Require
config.AutoFavPets     = config.AutoFavPets     or false
config.PetFavSelection = config.PetFavSelection or {}    -- map[name]=true

-- Remote
local favRemote = ReplicatedStorage
    :WaitForChild("GameEvents")
    :WaitForChild("Favorite_Item")

-- 1) H√†m check m·ªôt tool c√≥ match selection kh√¥ng
local function toolMatchesSelection(toolName)
    -- duy·ªát qua c√°c key trong config.PetFavSelection
    for selectedName, on in pairs(config.PetFavSelection) do
        if on then
            -- so s√°nh lowercase, tr√°nh ph√¢n bi·ªát hoa th∆∞·ªùng
            if string.lower(toolName):find(string.lower(selectedName)) then
                return true
            end
        end
    end
    return false
end

-- 2) UI: Dropdown ch·ªçn pet keyword
local allPetKeywords = {
    "Queen Bee","Bear Bee", "Petal Bee","Dragonfly","Raccoon","Red Giant Ant","Giant Ant","Mole","Praying Mantis",
    "Caterpillar","Snail","Echo Frog","Cow","Sea Otter","Moon Cat","Silver Monkey",
    "Squirrel","Chicken Zombie","Frog","Monkey","Pig","Grey Mouse","Blood Hedgehog",
    "Hedgehog","Panda","Turtle","Golden Lab","Owl","Polar Bear","Blood Kiwi","Kiwi",
    "Rooster","Blood Owl","Brown Mouse","Night Owl","Orange Tabby","Spotted Deer",
    "Cat","Chicken","Deer","Black Bunny","Bunny","Dog","Firefly","Bee","Honey Bee"
}

ddPets = FavoriteDTKTab:AddDropdown("PetFavSelection", {
    Title       = "Select Pets to Favorite",
    Description = "",
    Values      = allPetKeywords,
    Multi       = true,
    Default     = config.PetFavSelection,
    Callback    = function(selection)
        config.PetFavSelection = selection
        saveConfig()
    end
})
ddPets:SetValue(config.PetFavSelection)

-- 3) Toggle Auto Favorite Pets
FavoriteDTKTab:AddToggle("AutoFavPets", {
    Title   = "Auto Favorite Pets",
    Default = config.AutoFavPets,
    Callback = function(state)
        config.AutoFavPets = state
        saveConfig()
        autoFavPets = state

        if autoFavPets then
            task.spawn(function()
                local processed = {} -- ƒë·ªÉ tr√°nh favorite tr√πng
                while autoFavPets do
                    for _,tool in ipairs(LocalPlayer.Backpack:GetChildren()) do
                        if not tool:IsA("Tool") then
                            continue
                        end

                        local name = tool.Name
                        -- 1) Tool ph·∫£i match v·ªõi dropdown selection
                        if not toolMatchesSelection(name) then
                            continue
                        end

                        -- 2) Tool ch∆∞a ƒë∆∞·ª£c processed v√† ch∆∞a favorite (Attribute)
                        if processed[tool] then
                            continue
                        end
                        if tool:GetAttribute("Favorite") then
                            processed[tool] = true
                            continue
                        end

                        -- 3) G·ªçi remote favorite
                        pcall(function()
                            favRemote:FireServer(tool)
                        end)
                        processed[tool] = true
                        -- d√†nh ch√∫t th·ªùi gian ƒë·ªÉ game k·ªãp x·ª≠ l√Ω
                        task.wait(0.1)
                    end

                    -- D·ªçn d·∫πp processed map: lo·∫°i b·ªè tool ƒë√£ b·ªã xo√° (sell, drop‚Ä¶)
                    for t,_ in pairs(processed) do
                        if not t.Parent then
                            processed[t] = nil
                        end
                    end

                    task.wait(0.1)
                end
            end)
        end
    end
})
-- ‚Ä¶ (ph·∫ßn code ·ªü tr√™n) ‚Ä¶

-- 4) Button: Unfavorite All Pets
FavoriteDTKTab:AddButton({
    Title       = "Unfavorite All Pets",
    Description = "",
    Callback    = function()
        local favRemote = ReplicatedStorage
            :WaitForChild("GameEvents")
            :WaitForChild("Favorite_Item")

        -- Duy·ªát c·∫£ Backpack v√† Character
        local function processContainer(container)
            for _, tool in ipairs(container:GetChildren()) do
                if tool:IsA("Tool") then
                    local nameLower = tool.Name:lower()
                    -- ch·ªâ quan t√¢m tool c√≥ "age" v√† attribute Favorite == true
                    if nameLower:find("age") and tool:GetAttribute("Favorite") then
                        -- G·ªçi remote v·ªõi ch√≠nh instance tool ƒë√≥
                        pcall(function()
                            favRemote:FireServer(tool)
                        end)
                        task.wait(0.05)
                    end
                end
            end
        end

        -- Unfavorite trong Backpack
        processContainer(LocalPlayer.Backpack)
        -- Unfavorite tr√™n Character (n·∫øu ƒëang c·∫ßm tool)
        processContainer(LocalPlayer.Character or {})


    end
})



-- Kh·ªüi config l·∫ßn ƒë·∫ßu
config.ReduceGraphics = config.ReduceGraphics or false

-- Toggle Reduce Graphics
reduceToggle = ServerDTKTab:AddToggle("ReduceGraphics", {
    Title   = "Reduce Graphics",
    Default = config.ReduceGraphics,
    Callback = function(state)
        config.ReduceGraphics = state
        saveConfig()

        if state then
            -- 1) Danh s√°ch t√™n container c·∫ßn x·ª≠ l√Ω
            local containerNames = {
                "TopBaseplate",
                "Visuals",
                "PetsPhysical",
                "Farm",
                "Interaction"
            }

            -- 2) Gom container instances (ch·ªù t·ªëi ƒëa 5s m·ªói c√°i)
            local containers = {}
            for _, name in ipairs(containerNames) do
                local ok, inst = pcall(function()
                    return workspace:WaitForChild(name, 5)
                end)
                if ok and inst then
                    containers[#containers+1] = inst
                else
                    warn((""):format(name))
                end
            end

            -- 3) Set ƒë√£ x·ª≠ l√Ω ƒë·ªÉ kh√¥ng set l·∫°i ch·ªìng ch√©o
            local known = {}

            -- 4) H√†m ƒë·ªïi material + t·∫Øt cast shadow
            local function reduce(part)
                if part:IsA("BasePart") and not known[part] then
                    part.Material   = Enum.Material.SmoothPlastic
                    part.CastShadow = false
                    known[part]     = true
                end
            end

            -- 5) Qu√©t m·ªôt l∆∞·ª£t t·∫•t c·∫£ container v√† descendants
            for _, cont in ipairs(containers) do
                -- 5a) N·∫øu ch√≠nh n√≥ l√† Part th√¨ x·ª≠ l√Ω lu√¥n
                reduce(cont)
                -- 5b) Qu√©t descendants
                for _, desc in ipairs(cont:GetDescendants()) do
                    reduce(desc)
                end
            end

            -- 6) ƒêƒÉng listener cho m·ªói container, b·∫Øt ph·∫ßn t·ª≠ m·ªõi
            for _, cont in ipairs(containers) do
                cont.DescendantAdded:Connect(function(inst)
                    reduce(inst)
                end)
            end


        else

            -- L∆∞u √Ω: c√°c Part ƒë√£ chuy·ªÉn sang Air + t·∫Øt ƒë·ªï b√≥ng s·∫Ω kh√¥ng t·ª± ph·ª•c h·ªìi.
        end
    end
})

-- Kh·ªüi toggle theo config
reduceToggle:SetValue(config.ReduceGraphics)










-- Kh·ªüi m·∫∑c ƒë·ªãnh config
config.CustomWalkSpeed    = config.CustomWalkSpeed    or false
config.WalkSpeedMultiplier = config.WalkSpeedMultiplier or 1

config.CustomJumpPower    = config.CustomJumpPower    or false
config.JumpPowerMultiplier = config.JumpPowerMultiplier or 1

config.FlyEnabled         = config.FlyEnabled         or false

----------------------------------------------------------------
-- 1) WalkSpeed Toggle + Slider
----------------------------------------------------------------
local walkToggleActive = false
local walkSliderValue  = 1

-- Gi√° tr·ªã m·∫∑c ƒë·ªãnh
local DEFAULT_WALKSPEED = 20
-- 3) Fly Toggle
----------------------------------------------------------------
MiscDTKTab:AddToggle("fly", {
    Title   = "Fly",
    Default = config.FlyEnabled,
    Callback = function(val)
        flyEnabled = val
        config.FlyEnabled = val
        saveConfig()

        local player = game.Players.LocalPlayer
        local cam    = workspace.CurrentCamera
        local uis    = game:GetService("UserInputService")
        local rs     = game:GetService("RunService")

        local flying  = false

        if val then
            task.spawn(function()
                flying = true
                while flyEnabled and flying do
                    local root = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
                    if root then
                        local dir = Vector3.new()
                        if uis:IsKeyDown(Enum.KeyCode.W) then dir += cam.CFrame.LookVector end
                        if uis:IsKeyDown(Enum.KeyCode.S) then dir -= cam.CFrame.LookVector end
                        if uis:IsKeyDown(Enum.KeyCode.A) then dir -= cam.CFrame.RightVector end
                        if uis:IsKeyDown(Enum.KeyCode.D) then dir += cam.CFrame.RightVector end
                        if uis:IsKeyDown(Enum.KeyCode.Space) then dir += cam.CFrame.UpVector end
                        if uis:IsKeyDown(Enum.KeyCode.LeftShift) then dir -= cam.CFrame.UpVector end

                        if dir.Magnitude > 0 then
                            dir = dir.Unit * 50
                        end
                        root.Velocity = dir
                    end
                    rs.RenderStepped:Wait()
                end
            end)
        else
            flying = false
        end
    end
})


-- Toggle WalkSpeed
MiscDTKTab:AddToggle("WalkSpeedToggle", {
    Title   = "Walk Speed",
    Default = config.CustomWalkSpeed,
    Callback = function(state)
        walkToggleActive = state
        config.CustomWalkSpeed = state
        saveConfig()

        if not walkToggleActive then
            Humanoid.WalkSpeed = DEFAULT_WALKSPEED
        else
            Humanoid.WalkSpeed = walkSliderValue * DEFAULT_WALKSPEED
        end
    end
})

-- Slider WalkSpeed
speedslider = MiscDTKTab:AddSlider("WalkSpeedSlider", {
    Title   = "WalkSpeed Multiplier",
    Min     = 1,
    Max     = 20,
    Default = config.WalkSpeedMultiplier,
    Rounding= 0,
    Callback = function(val)
        walkSliderValue = val
        config.WalkSpeedMultiplier = val
        saveConfig()

        if walkToggleActive then
            Humanoid.WalkSpeed = walkSliderValue * DEFAULT_WALKSPEED
        end
    end
})
-- G√°n l·∫°i gi√° tr·ªã slider t·ª´ config khi load GUI
speedslider:SetValue(config.WalkSpeedMultiplier)
----------------------------------------------------------------
-- 2) JumpPower Toggle + Slider
----------------------------------------------------------------
local jumpToggleActive = false
local jumpSliderValue  = 1

-- Gi√° tr·ªã m·∫∑c ƒë·ªãnh
local DEFAULT_JUMPPOWER = 50

-- Toggle JumpPower
MiscDTKTab:AddToggle("JumpPowerToggle", {
    Title   = "Jump Power",
    Default = config.CustomJumpPower,
    Callback = function(state)
        jumpToggleActive = state
        config.CustomJumpPower = state
        saveConfig()

        if not jumpToggleActive then
            Humanoid.JumpPower = DEFAULT_JUMPPOWER
        else
            Humanoid.JumpPower = jumpSliderValue * DEFAULT_JUMPPOWER
        end
    end
})

-- Slider JumpPower
jumpslider = MiscDTKTab:AddSlider("JumpPowerSlider", {
    Title   = "JumpPower Multiplier",
    Min     = 1,
    Max     = 10,
    Default = config.JumpPowerMultiplier,
    Rounding= 0,
    Callback = function(val)
        jumpSliderValue = val
        config.JumpPowerMultiplier = val
        saveConfig()

        if jumpToggleActive then
            Humanoid.JumpPower = jumpSliderValue * DEFAULT_JUMPPOWER
        end
    end
})
-- G√°n l·∫°i gi√° tr·ªã slider t·ª´ config khi load GUI
jumpslider:SetValue(config.JumpPowerMultiplier)
----------------------------------------------------------------

local player = Players.LocalPlayer
local gui = Instance.new("ScreenGui")
gui.Name = "OpenButtonGui"
gui.ResetOnSpawn = false
gui.IgnoreGuiInset = true
gui.Parent = player:WaitForChild("PlayerGui")

local button = Instance.new("ImageButton")
button.Size = UDim2.new(0, 50, 0, 50)
button.Position = UDim2.new(0, 20, 0, 250)
button.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
button.BackgroundTransparency = 0.25
button.Image = "rbxassetid://128961717706452" -- ƒê·ªÉ tr·ªëng ho·∫∑c d√πng icon tr√≤n t√πy b·∫°n
button.Name = "FloatingToggle"
button.Active = true
button.Draggable = true
button.Parent = gui

-- L√†m n√∫t th√†nh h√¨nh tr√≤n
local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(1, 0)
corner.Parent = button

-- Khi nh·∫•n v√†o, gi·∫£ l·∫≠p nh·∫•n RightControl
button.MouseButton1Click:Connect(function()
    VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.LeftControl, false, game)
    task.wait(0.05)
    VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.LeftControl, false, game)
end)
